!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).MasqClient=e()}}(function(){return function e(t,r,n){function o(s,c){if(!r[s]){if(!t[s]){var u="function"==typeof require&&require;if(!c&&u)return u(s,!0);if(i)return i(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var a=r[s]={exports:{}};t[s][0].call(a.exports,function(e){var r=t[s][1][e];return o(r||e)},a,a.exports,e,t,r,n)}return r[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(e,t,r){!function(e){function n(e,t){e=e||"https://qwantresearch.github.io/masq-hub/",t=t||{},this._id=n._generateUUID(),this._promise=t.promise||Promise,this._frameId=t.frameId||"MasqClient-"+this._id,this._origin=n._getOrigin(e),this._requests={},this._connected=!1,this._closed=!1,this._count=0,this._timeout=t.timeout||5e3,this._listener=null,this._installListener();var r;t.frameId&&(r=document.getElementById(t.frameId)),r&&this._poll(),r=r||this._createFrame(e),this._hub=r.contentWindow}n.frameStyle={display:"none",position:"absolute",top:"-999px",left:"-999px"},n._getOrigin=function(e){var t,r,n;return t=document.createElement("a"),t.href=e,t.host||(t=window.location),r=t.protocol&&":"!==t.protocol?t.protocol:window.location.protocol,n=r+"//"+t.host,n=n.replace(/:80$|:443$/,"")},n._generateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},n.prototype.onConnect=function(){var e=this;return this._connected?this._promise.resolve():this._closed?this._promise.reject(new Error("MasqClient has closed")):(this._requests.connect||(this._requests.connect=[]),new this._promise(function(t,r){var n=setTimeout(function(){r(new Error("MasqClient could not connect"))},e._timeout);e._requests.connect.push(function(e){if(clearTimeout(n),e)return r(e);t()})}))},n.prototype.set=function(e,t){return this._request("set",{key:e,value:t})},n.prototype.get=function(e){var t=Array.prototype.slice.call(arguments);return this._request("get",{keys:t})},n.prototype.del=function(){var e=Array.prototype.slice.call(arguments);return this._request("del",{keys:e})},n.prototype.clear=function(){return this._request("clear")},n.prototype.getAll=function(){return this._request("getAll")},n.prototype.setAll=function(e){return this._request("setAll",e)},n.prototype.close=function(){var e=document.getElementById(this._frameId);e&&e.parentNode.removeChild(e),window.removeEventListener?window.removeEventListener("message",this._listener,!1):window.detachEvent("onmessage",this._listener),this._connected=!1,this._closed=!0},n.prototype._installListener=function(){var e=this;this._listener=function(t){var r,n,o;if(!e._closed&&t.data&&("null"===t.origin?"file://":t.origin)===e._origin)if("unavailable"!==t.data["cross-storage"]){if(t.data["cross-storage"]&&!e._connected){if(e._connected=!0,!e._requests.connect)return;for(r=0;r<e._requests.connect.length;r++)e._requests.connect[r](n);delete e._requests.connect}if("ready"!==t.data["cross-storage"]){try{o=t.data}catch(e){return}o.client&&e._requests[o.client]&&e._requests[o.client](o.error,o.result)}}else{if(e._closed||e.close(),!e._requests.connect)return;for(n=new Error("Closing client. Could not access localStorage in hub."),r=0;r<e._requests.connect.length;r++)e._requests.connect[r](n)}},window.addEventListener?window.addEventListener("message",this._listener,!1):window.attachEvent("onmessage",this._listener)},n.prototype._poll=function(){var e,t,r;r="file://"===(e=this)._origin?"*":e._origin,t=setInterval(function(){if(e._connected)return clearInterval(t);e._hub&&e._hub.postMessage({"cross-storage":"poll"},r)},1e3)},n.prototype._createFrame=function(e){var t,r;(t=window.document.createElement("iframe")).id=this._frameId;for(r in n.frameStyle)n.frameStyle.hasOwnProperty(r)&&(t.style[r]=n.frameStyle[r]);return window.document.body.appendChild(t),t.src=e,t},n.prototype._request=function(e,t){var r,n;return this._closed?this._promise.reject(new Error("MasqClient has closed")):(n=this,n._count++,r={client:this._id+":"+n._count,method:e,params:t},new this._promise(function(e,t){var o,i,s;o=setTimeout(function(){n._requests[r.client]&&(delete n._requests[r.client],t(new Error("Timeout: could not perform "+r.method)))},n._timeout),n._requests[r.client]=function(i,s){if(clearTimeout(o),delete n._requests[r.client],i)return t(new Error(i));e(s)},Array.prototype.toJSON&&(i=Array.prototype.toJSON,Array.prototype.toJSON=null),s="file://"===n._origin?"*":n._origin,n._hub.postMessage(r,s),i&&(Array.prototype.toJSON=i)}))},void 0!==t&&t.exports?t.exports=n:void 0!==r?r.MasqClient=n:e.MasqClient=n}(this)},{}]},{},[1])(1)});